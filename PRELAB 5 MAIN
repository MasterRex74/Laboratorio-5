//*******************************************************************************************************************************************
//Universidad del Valle de Guatemala
//IE2023 Programación de Microcontroladores
//main.c
//Proyecto: PRELAB 5
//Hardware: ATMEGA328P
//Created: 04/14/2024
//Author : Juan Luis Monzón Catalán
//********************************************************************************************************************************************

//********************************************************************************************************************************************
//LIBRERIAS
//********************************************************************************************************************************************

#define F_CPU 16000000
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>
#include "ADC/ADC.h"
#include "PWM1/PWM1.h"

//********************************************************************************************************************************************
//V. G.
//********************************************************************************************************************************************

uint8_t POT1 = 0;

//********************************************************************************************************************************************
//DECLARACIÓN DE FUNCIONES
//********************************************************************************************************************************************
void SETUP(void);


//********************************************************************************************************************************************
//MAIN
//********************************************************************************************************************************************
int main(void)
{
	SETUP();
	
	S_ADC(exter, izq, 7);
	C_ADC(1, 0, 1, 128);
	
    initPWM1FastA(1, 8);

    while (1) 
    {
		ADCSRA |= (1 << ADSC);
		
		UPDATEDUTYCYCLEA1(POT1);
		
		_delay_ms(10);
				
    }
}

//********************************************************************************************************************************************
//SETUP
//********************************************************************************************************************************************
void SETUP(void){
	DDRD |= (1 << DDB2) | (1 << DDB1);										//USAMOS PB2 Y PB1 PARA LOS SERVOS (OC1A Y OC1B)
	DDRD |= (1 << DDD3);													//USAMOS PD3 PARA EL LED (OC2B)
}

//********************************************************************************************************************************************
//INTERRUPCIONES
//********************************************************************************************************************************************
ISR(ADC_vect){
	//POT1 = (ADCH / 7);														//LEER VALOR DEL POTENCIOMETRO
	
	ADCSRA |= (1 << ADIF);													//APAGRA LA BANDERA DEL ADC
}
